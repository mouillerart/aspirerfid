<?xml version="1.0" encoding="ISO-8859-1" standalone="yes"?>
<project xmlns:jmx="antlib:org.apache.catalina.ant.jmx" basedir="." default="main" name="supplychain.edge1">

<!--Properties Definitions-->
<property file="./config.build.properties"/>

<!--Macro Definitions-->
<macrodef name="openConnection">
  <attribute name="ref"/>
  <attribute name="serviceurl"/>
  <attribute name="username"/>
  <attribute name="password"/>
  <sequential>
  <echo message="Connection @{serviceurl} on @{ref}"/>
  <jmx:open password="@{password}" username="@{username}" url="@{serviceurl}" ref="@{ref}"/>
  </sequential>
</macrodef>

<macrodef name="closeConnection">
  <attribute name="ref"/>
  <sequential>
  <jmx:close ref="@{ref}"/>
  </sequential>
</macrodef>

<!--Targets-->

<target depends="init" name="main">
  <echo>
            Note: copy your catalina-ant.jar and
            catalina-ant-jmx.jar from $CATALINA_HOME/server/lib
            to $ANT_HOME/lib
          </echo>
  <parallel>
    <antcall target="exec.edge1"/>
  </parallel>
</target>

<target name="init">

  <tstamp>
  <format locale="en" pattern="d-MMMM-yyyy hh:mm aa" property="date"/>
  </tstamp>
  <property value="Didier DONSEZ" name="author"/>
</target>

<!--Target for agent edge1 -->
<target name="exec.edge1">

    <openConnection password="${edge1.jmx.password}" username="${edge1.jmx.username}" serviceurl="${edge1.jmx.serviceurl}" ref="edge1.jmx.connection.ref"/>

    <jmx:set
      ref="edge1.jmx.connection.ref"
      name="rfid:type=service,SymbolicName=TagsysDriver"
      echo="true"
      type="java.lang.String" value="COM2" attribute="PortName"
      />

    <jmx:invoke
      ref="edge1.jmx.connection.ref"
      name="rfid:type=service,SymbolicName=TagsysDriver"
      operation="newReader"
      />

    <jmx:set
      ref="edge1.jmx.connection.ref"
      name="rfid:type=reader,SymbolicName=TagSysReader1"
      echo="true"
      type="java.lang.String" value="50.845,4.349992" attribute="GpsCoordinates"
      /> <!-- Bruxels -->

    <jmx:invoke
      ref="edge1.jmx.connection.ref"
      name="rfid:type=reader,SymbolicName=TagSysReader1"
      operation="startReader"
      />

    <jmx:invoke
      ref="edge1.jmx.connection.ref"
      name="rfid:type=service,SymbolicName=ECSpecFactory"
      operation="addLogicalReaderName"
      >
        <arg value="tagsys"/>
      </jmx:invoke>

    <jmx:invoke
      ref="edge1.jmx.connection.ref"
      name="rfid:type=service,SymbolicName=ECSpecFactory"
      operation="addECReportSpec"
      >
        <arg value="myreport"/>
        <arg value="true" type="boolean"/>
        <arg value="true" type="boolean"/>
        <arg value="true" type="boolean"/>
        <arg value="true" type="boolean"/>
        <arg value="true" type="boolean"/>
        <arg value=""/>
        <arg value="true" type="boolean"/>
        <arg value="true" type="boolean"/>
        <arg value="true" type="boolean"/>
        <arg value="true" type="boolean"/>
        <arg value="true" type="boolean"/>
      </jmx:invoke>

    <jmx:invoke
      ref="edge1.jmx.connection.ref"
      name="rfid:type=service,SymbolicName=ECSpecFactory"
      operation="createECSpec"
      >
        <arg value="myecspec"/>
      </jmx:invoke>

    <jmx:invoke
      ref="edge1.jmx.connection.ref"
      name="rfid:type=service,SymbolicName=ALE"
      operation="subscribe"
      >
        <arg value="myecspec"/>
        <arg value="jms:fr.dyade.aaa.jndi2.client.NamingContextFactory/127.0.0.1/16400/127.0.0.1/16010/JTCF/rfidservertopic/root/root"/>
      </jmx:invoke>
<!--
   soap:http://127.0.0.1:9090/ReportServiceImpl?wsdl
  jms:fr.dyade.aaa.jndi2.client.NamingContextFactory/127.0.0.1/16400/127.0.0.1/16010/JTCF/rfidservertopic/root/root
-->
<!--
	jmx:close was removed from the Tomcat dist !!! ;-(

	<closeConnection ref="edge1.jmx.connection.ref"/>
-->
</target>
</project>
